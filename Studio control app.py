import tkinter as tk
from tkinter import ttk, messagebox
import json
import os
from datetime import datetime, timedelta
import matplotlib.pyplot as plt
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
import threading
import time

class StudyTrackerApp:
    def __init__(self, root):
        self.root = root
        self.root.title("üìö G√ºnl√ºk √áalƒ±≈üma Takip√ßisi")
        self.root.geometry("900x700")
        self.root.configure(bg='#f0f0f0')
        
        # Veri dosyasƒ±
        self.data_file = "study_data.json"
        self.load_data()
        
        # Timer deƒüi≈ükenleri
        self.timer_running = False
        self.start_time = None
        self.elapsed_time = 0
        self.timer_thread = None
        
        # Saat thread'i
        self.clock_thread = None
        self.clock_running = True
        
        # Dersler
        self.subjects = ["Matematik", "T√ºrk√ße", "Fen", "Sosyal", "ƒ∞ngilizce", "Diƒüer"]
        
        self.setup_ui()
        self.update_display()
        
        # Saati ba≈ülat
        self.start_clock()
        
        # Gece yarƒ±sƒ± kontrol√º
        self.check_day_reset()
        
    def load_data(self):
        """Veri dosyasƒ±nƒ± y√ºkle"""
        if os.path.exists(self.data_file):
            try:
                with open(self.data_file, 'r', encoding='utf-8') as f:
                    self.data = json.load(f)
            except:
                self.data = {}
        else:
            self.data = {}
    
    def save_data(self):
        """Veriyi kaydet"""
        try:
            with open(self.data_file, 'w', encoding='utf-8') as f:
                json.dump(self.data, f, indent=2, ensure_ascii=False)
        except Exception as e:
            messagebox.showerror("Hata", f"Veri kaydedilemedi: {e}")
    
    def get_today_key(self):
        """Bug√ºn√ºn tarih anahtarƒ±nƒ± d√∂nd√ºr"""
        return datetime.now().strftime("%Y-%m-%d")
    
    def get_today_data(self):
        """Bug√ºn√ºn verilerini getir"""
        today = self.get_today_key()
        if today not in self.data:
            self.data[today] = {
                "questions": {subject: {"correct": 0, "wrong": 0} for subject in self.subjects},
                "pages_read": 0,
                "notes_written": 0,
                "study_time": 0,
                "empty_day": True
            }
        return self.data[today]
    
    def start_clock(self):
        """Saati ba≈ülat"""
        self.clock_thread = threading.Thread(target=self.update_clock)
        self.clock_thread.daemon = True
        self.clock_thread.start()
    
    def update_clock(self):
        """Saati g√ºncelle"""
        while self.clock_running:
            try:
                current_time = datetime.now()
                time_str = current_time.strftime("%H:%M:%S")
                date_str = current_time.strftime("%d.%m.%Y")
                day_str = current_time.strftime("%A")
                
                # T√ºrk√ße g√ºn isimleri
                days_turkish = {
                    "Monday": "Pazartesi",
                    "Tuesday": "Salƒ±", 
                    "Wednesday": "√áar≈üamba",
                    "Thursday": "Per≈üembe",
                    "Friday": "Cuma",
                    "Saturday": "Cumartesi",
                    "Sunday": "Pazar"
                }
                day_turkish = days_turkish.get(day_str, day_str)
                
                # Saati g√ºncelle
                if hasattr(self, 'clock_label'):
                    self.clock_label.config(text=time_str)
                if hasattr(self, 'date_label'):
                    self.date_label.config(text=f"{date_str} - {day_turkish}")
                
                time.sleep(1)
            except:
                break
    
    def setup_ui(self):
        """Aray√ºz√º olu≈ütur"""
        # Ana ba≈ülƒ±k ve saat frame
        header_frame = tk.Frame(self.root, bg='#2c3e50', height=80)
        header_frame.pack(fill=tk.X)
        header_frame.pack_propagate(False)
        
        # Sol taraf - ba≈ülƒ±k
        title_frame = tk.Frame(header_frame, bg='#2c3e50')
        title_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        
        title_label = tk.Label(title_frame, text="üìö G√ºnl√ºk √áalƒ±≈üma Takip√ßisi", 
                              font=('Arial', 16, 'bold'), fg='white', bg='#2c3e50')
        title_label.pack(pady=(10, 0))
        
        # Saƒü taraf - saat ve tarih
        clock_frame = tk.Frame(header_frame, bg='#2c3e50')
        clock_frame.pack(side=tk.RIGHT, padx=20, pady=10)
        
        # Saat
        self.clock_label = tk.Label(clock_frame, text="--:--:--", 
                                   font=('Arial', 18, 'bold'), fg='#3498db', bg='#2c3e50')
        self.clock_label.pack()
        
        # Tarih
        self.date_label = tk.Label(clock_frame, text="--.--.---- - ---", 
                                  font=('Arial', 10), fg='#95a5a6', bg='#2c3e50')
        self.date_label.pack()
        
        # Ana i√ßerik frame
        main_frame = tk.Frame(self.root, bg='#f0f0f0')
        main_frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
        
        # Sol panel - Veri giri≈üi
        left_frame = tk.Frame(main_frame, bg='white', relief=tk.RAISED, bd=2)
        left_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(0, 5))
        
        # Timer b√∂l√ºm√º
        timer_frame = tk.LabelFrame(left_frame, text="‚è±Ô∏è √áalƒ±≈üma S√ºresi", 
                                   font=('Arial', 12, 'bold'), bg='white')
        timer_frame.pack(fill=tk.X, padx=10, pady=10)
        
        # Timer ve ba≈ülangƒ±√ß saati frame
        timer_info_frame = tk.Frame(timer_frame, bg='white')
        timer_info_frame.pack(pady=5)
        
        # Sol taraf - timer
        timer_left = tk.Frame(timer_info_frame, bg='white')
        timer_left.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        
        self.timer_label = tk.Label(timer_left, text="00:00:00", 
                                   font=('Arial', 20, 'bold'), fg='#e74c3c', bg='white')
        self.timer_label.pack()
        
        # Saƒü taraf - ba≈ülangƒ±√ß saati
        timer_right = tk.Frame(timer_info_frame, bg='white')
        timer_right.pack(side=tk.RIGHT, padx=20)
        
        tk.Label(timer_right, text="Ba≈ülangƒ±√ß:", font=('Arial', 9), fg='#7f8c8d', bg='white').pack()
        self.start_time_label = tk.Label(timer_right, text="--:--", 
                                        font=('Arial', 12, 'bold'), fg='#27ae60', bg='white')
        self.start_time_label.pack()
        
        timer_btn_frame = tk.Frame(timer_frame, bg='white')
        timer_btn_frame.pack(pady=5)
        
        self.start_btn = tk.Button(timer_btn_frame, text="Ba≈ülat", 
                                  command=self.start_timer, bg='#27ae60', fg='white',
                                  font=('Arial', 10, 'bold'), width=8)
        self.start_btn.pack(side=tk.LEFT, padx=5)
        
        self.stop_btn = tk.Button(timer_btn_frame, text="Durdur", 
                                 command=self.stop_timer, bg='#e74c3c', fg='white',
                                 font=('Arial', 10, 'bold'), width=8)
        self.stop_btn.pack(side=tk.LEFT, padx=5)
        
        # Soru √ß√∂zme b√∂l√ºm√º
        question_frame = tk.LabelFrame(left_frame, text="üìù Soru √á√∂zme", 
                                      font=('Arial', 12, 'bold'), bg='white')
        question_frame.pack(fill=tk.X, padx=10, pady=10)
        
        # Ders se√ßimi
        tk.Label(question_frame, text="Ders:", font=('Arial', 10), bg='white').pack(anchor=tk.W, padx=5)
        self.subject_var = tk.StringVar(value=self.subjects[0])
        subject_combo = ttk.Combobox(question_frame, textvariable=self.subject_var, 
                                    values=self.subjects, state='readonly', width=20)
        subject_combo.pack(pady=5, padx=5)
        
        # Doƒüru-Yanlƒ±≈ü giri≈üi
        qa_frame = tk.Frame(question_frame, bg='white')
        qa_frame.pack(pady=10)
        
        tk.Label(qa_frame, text="Doƒüru:", font=('Arial', 10), bg='white').grid(row=0, column=0, padx=5)
        self.correct_var = tk.StringVar(value="0")
        correct_entry = tk.Entry(qa_frame, textvariable=self.correct_var, width=10)
        correct_entry.grid(row=0, column=1, padx=5)
        
        tk.Label(qa_frame, text="Yanlƒ±≈ü:", font=('Arial', 10), bg='white').grid(row=0, column=2, padx=5)
        self.wrong_var = tk.StringVar(value="0")
        wrong_entry = tk.Entry(qa_frame, textvariable=self.wrong_var, width=10)
        wrong_entry.grid(row=0, column=3, padx=5)
        
        tk.Button(question_frame, text="Soru Ekle", command=self.add_questions,
                 bg='#3498db', fg='white', font=('Arial', 10, 'bold')).pack(pady=5)
        
        # Diƒüer aktiviteler
        other_frame = tk.LabelFrame(left_frame, text="üìñ Diƒüer Aktiviteler", 
                                   font=('Arial', 12, 'bold'), bg='white')
        other_frame.pack(fill=tk.X, padx=10, pady=10)
        
        # Sayfa okuma
        page_frame = tk.Frame(other_frame, bg='white')
        page_frame.pack(pady=5)
        tk.Label(page_frame, text="Okunan Sayfa:", font=('Arial', 10), bg='white').pack(side=tk.LEFT)
        self.pages_var = tk.StringVar(value="0")
        pages_entry = tk.Entry(page_frame, textvariable=self.pages_var, width=10)
        pages_entry.pack(side=tk.LEFT, padx=5)
        tk.Button(page_frame, text="Ekle", command=self.add_pages,
                 bg='#9b59b6', fg='white', font=('Arial', 8, 'bold')).pack(side=tk.LEFT, padx=5)
        
        # Not yazma
        notes_frame = tk.Frame(other_frame, bg='white')
        notes_frame.pack(pady=5)
        tk.Label(notes_frame, text="Yazƒ±lan Not:", font=('Arial', 10), bg='white').pack(side=tk.LEFT)
        self.notes_var = tk.StringVar(value="0")
        notes_entry = tk.Entry(notes_frame, textvariable=self.notes_var, width=10)
        notes_entry.pack(side=tk.LEFT, padx=5)
        tk.Button(notes_frame, text="Ekle", command=self.add_notes,
                 bg='#f39c12', fg='white', font=('Arial', 8, 'bold')).pack(side=tk.LEFT, padx=5)
        
        # Saƒü panel - ƒ∞statistikler
        right_frame = tk.Frame(main_frame, bg='white', relief=tk.RAISED, bd=2)
        right_frame.pack(side=tk.RIGHT, fill=tk.BOTH, expand=True, padx=(5, 0))
        
        # G√ºnl√ºk √∂zet
        summary_frame = tk.LabelFrame(right_frame, text="üìä G√ºnl√ºk √ñzet", 
                                     font=('Arial', 12, 'bold'), bg='white')
        summary_frame.pack(fill=tk.X, padx=10, pady=10)
        
        self.summary_text = tk.Text(summary_frame, height=8, width=30, 
                                   font=('Arial', 10), bg='#f8f9fa')
        self.summary_text.pack(pady=10, padx=10)
        
        # Butonlar
        btn_frame = tk.Frame(right_frame, bg='white')
        btn_frame.pack(fill=tk.X, padx=10, pady=10)
        
        tk.Button(btn_frame, text="üìà Grafikleri G√∂ster", command=self.show_graphs,
                 bg='#1abc9c', fg='white', font=('Arial', 10, 'bold')).pack(fill=tk.X, pady=2)
        
        tk.Button(btn_frame, text="üìÖ Haftalƒ±k Rapor", command=self.weekly_report,
                 bg='#34495e', fg='white', font=('Arial', 10, 'bold')).pack(fill=tk.X, pady=2)
        
        tk.Button(btn_frame, text="üóëÔ∏è Bug√ºn√º Sƒ±fƒ±rla", command=self.reset_today,
                 bg='#e67e22', fg='white', font=('Arial', 10, 'bold')).pack(fill=tk.X, pady=2)
    
    def start_timer(self):
        """Timer'ƒ± ba≈ülat"""
        if not self.timer_running:
            self.timer_running = True
            self.start_time = time.time()
            
            # Ba≈ülangƒ±√ß saatini g√∂ster
            start_time_str = datetime.now().strftime("%H:%M")
            self.start_time_label.config(text=start_time_str)
            
            self.timer_thread = threading.Thread(target=self.update_timer)
            self.timer_thread.daemon = True
            self.timer_thread.start()
            self.start_btn.config(state=tk.DISABLED)
            self.stop_btn.config(state=tk.NORMAL)
    
    def stop_timer(self):
        """Timer'ƒ± durdur"""
        if self.timer_running:
            self.timer_running = False
            if self.start_time:
                self.elapsed_time += time.time() - self.start_time
                today_data = self.get_today_data()
                today_data["study_time"] = self.elapsed_time
                today_data["empty_day"] = False
                self.save_data()
            self.start_btn.config(state=tk.NORMAL)
            self.stop_btn.config(state=tk.DISABLED)
            self.start_time_label.config(text="--:--")
    
    def update_timer(self):
        """Timer'ƒ± g√ºncelle"""
        while self.timer_running:
            if self.start_time:
                current_time = self.elapsed_time + (time.time() - self.start_time)
                hours = int(current_time // 3600)
                minutes = int((current_time % 3600) // 60)
                seconds = int(current_time % 60)
                time_str = f"{hours:02d}:{minutes:02d}:{seconds:02d}"
                self.timer_label.config(text=time_str)
            time.sleep(1)
    
    def add_questions(self):
        """Soru ekle"""
        try:
            subject = self.subject_var.get()
            correct = int(self.correct_var.get())
            wrong = int(self.wrong_var.get())
            
            if correct < 0 or wrong < 0:
                messagebox.showerror("Hata", "Negatif sayƒ± girilemez!")
                return
            
            today_data = self.get_today_data()
            today_data["questions"][subject]["correct"] += correct
            today_data["questions"][subject]["wrong"] += wrong
            
            if correct > 0 or wrong > 0:
                today_data["empty_day"] = False
            
            self.save_data()
            self.update_display()
            
            # Giri≈üleri sƒ±fƒ±rla
            self.correct_var.set("0")
            self.wrong_var.set("0")
            
            messagebox.showinfo("Ba≈üarƒ±lƒ±", f"{subject} dersine {correct} doƒüru, {wrong} yanlƒ±≈ü eklendi!")
            
        except ValueError:
            messagebox.showerror("Hata", "L√ºtfen ge√ßerli sayƒ± girin!")
    
    def add_pages(self):
        """Sayfa ekle"""
        try:
            pages = int(self.pages_var.get())
            if pages < 0:
                messagebox.showerror("Hata", "Negatif sayƒ± girilemez!")
                return
            
            today_data = self.get_today_data()
            today_data["pages_read"] += pages
            
            if pages > 0:
                today_data["empty_day"] = False
            
            self.save_data()
            self.update_display()
            self.pages_var.set("0")
            
            messagebox.showinfo("Ba≈üarƒ±lƒ±", f"{pages} sayfa eklendi!")
            
        except ValueError:
            messagebox.showerror("Hata", "L√ºtfen ge√ßerli sayƒ± girin!")
    
    def add_notes(self):
        """Not ekle"""
        try:
            notes = int(self.notes_var.get())
            if notes < 0:
                messagebox.showerror("Hata", "Negatif sayƒ± girilemez!")
                return
            
            today_data = self.get_today_data()
            today_data["notes_written"] += notes
            
            if notes > 0:
                today_data["empty_day"] = False
            
            self.save_data()
            self.update_display()
            self.notes_var.set("0")
            
            messagebox.showinfo("Ba≈üarƒ±lƒ±", f"{notes} sayfa not eklendi!")
            
        except ValueError:
            messagebox.showerror("Hata", "L√ºtfen ge√ßerli sayƒ± girin!")
    
    def update_display(self):
        """Ekranƒ± g√ºncelle"""
        today_data = self.get_today_data()
        
        # √ñzet metni
        self.summary_text.delete(1.0, tk.END)
        self.summary_text.insert(tk.END, f"üìÖ Bug√ºn: {datetime.now().strftime('%d.%m.%Y')}\n\n")
        
        # √áalƒ±≈üma s√ºresi
        study_time = today_data["study_time"]
        hours = int(study_time // 3600)
        minutes = int((study_time % 3600) // 60)
        self.summary_text.insert(tk.END, f"‚è±Ô∏è √áalƒ±≈üma S√ºresi: {hours}s {minutes}d\n\n")
        
        # Sorular
        self.summary_text.insert(tk.END, "üìù √á√∂z√ºlen Sorular:\n")
        total_correct = 0
        total_wrong = 0
        for subject, data in today_data["questions"].items():
            correct = data["correct"]
            wrong = data["wrong"]
            total_correct += correct
            total_wrong += wrong
            if correct > 0 or wrong > 0:
                self.summary_text.insert(tk.END, f"  {subject}: {correct}D/{wrong}Y\n")
        
        self.summary_text.insert(tk.END, f"\nToplam: {total_correct}D/{total_wrong}Y\n\n")
        
        # Diƒüer aktiviteler
        self.summary_text.insert(tk.END, f"üìñ Okunan Sayfa: {today_data['pages_read']}\n")
        self.summary_text.insert(tk.END, f"üìù Yazƒ±lan Not: {today_data['notes_written']} sayfa\n")
    
    def show_graphs(self):
        """Grafikleri g√∂ster"""
        if not self.data:
            messagebox.showinfo("Bilgi", "Hen√ºz veri yok!")
            return
        
        # Grafik penceresi
        graph_window = tk.Toplevel(self.root)
        graph_window.title("üìà Grafikler")
        graph_window.geometry("800x600")
        
        # Notebook (sekmeler)
        notebook = ttk.Notebook(graph_window)
        notebook.pack(fill=tk.BOTH, expand=True)
        
        # Doƒüru/Yanlƒ±≈ü grafikleri
        self.create_question_graphs(notebook)
        
        # G√ºnl√ºk aktivite grafiƒüi
        self.create_daily_activity_graph(notebook)
    
    def create_question_graphs(self, notebook):
        """Soru grafiklerini olu≈ütur"""
        frame = ttk.Frame(notebook)
        notebook.add(frame, text="Soru Grafikleri")
        
        fig, axes = plt.subplots(2, 3, figsize=(15, 10))
        fig.suptitle('Dersler Bazƒ±nda Soru √á√∂zme ƒ∞statistikleri', fontsize=16)
        
        for i, subject in enumerate(self.subjects):
            row = i // 3
            col = i % 3
            ax = axes[row, col]
            
            # Veri toplama
            dates = []
            correct_counts = []
            wrong_counts = []
            
            for date, data in sorted(self.data.items()):
                dates.append(date)
                correct_counts.append(data["questions"][subject]["correct"])
                wrong_counts.append(data["questions"][subject]["wrong"])
            
            # Grafik √ßizme
            if dates:
                ax.bar(dates, correct_counts, label='Doƒüru', color='green', alpha=0.7)
                ax.bar(dates, wrong_counts, bottom=correct_counts, label='Yanlƒ±≈ü', color='red', alpha=0.7)
                ax.set_title(subject)
                ax.set_xlabel('Tarih')
                ax.set_ylabel('Soru Sayƒ±sƒ±')
                ax.legend()
                ax.tick_params(axis='x', rotation=45)
        
        plt.tight_layout()
        
        canvas = FigureCanvasTkAgg(fig, frame)
        canvas.draw()
        canvas.get_tk_widget().pack(fill=tk.BOTH, expand=True)
    
    def create_daily_activity_graph(self, notebook):
        """G√ºnl√ºk aktivite grafiƒüi"""
        frame = ttk.Frame(notebook)
        notebook.add(frame, text="G√ºnl√ºk Aktivite")
        
        fig, ax = plt.subplots(figsize=(12, 6))
        
        dates = []
        study_times = []
        pages_read = []
        notes_written = []
        
        for date, data in sorted(self.data.items()):
            dates.append(date)
            study_times.append(data["study_time"] / 3600)  # Saate √ßevir
            pages_read.append(data["pages_read"])
            notes_written.append(data["notes_written"])
        
        if dates:
            ax.plot(dates, study_times, marker='o', label='√áalƒ±≈üma S√ºresi (saat)', color='blue')
            ax.plot(dates, pages_read, marker='s', label='Okunan Sayfa', color='green')
            ax.plot(dates, notes_written, marker='^', label='Yazƒ±lan Not', color='orange')
            
            ax.set_title('G√ºnl√ºk Aktivite Grafiƒüi')
            ax.set_xlabel('Tarih')
            ax.set_ylabel('Miktar')
            ax.legend()
            ax.grid(True, alpha=0.3)
            plt.xticks(rotation=45)
        
        plt.tight_layout()
        
        canvas = FigureCanvasTkinter(fig, frame)
        canvas.draw()
        canvas.get_tk_widget().pack(fill=tk.BOTH, expand=True)
    
    def weekly_report(self):
        """Haftalƒ±k rapor"""
        if not self.data:
            messagebox.showinfo("Bilgi", "Hen√ºz veri yok!")
            return
        
        # Son 7 g√ºn√ºn verilerini al
        today = datetime.now()
        week_dates = []
        for i in range(7):
            date = today - timedelta(days=i)
            week_dates.append(date.strftime("%Y-%m-%d"))
        
        empty_days = 0
        total_questions = 0
        total_pages = 0
        total_notes = 0
        total_study_time = 0
        
        for date in week_dates:
            if date in self.data:
                data = self.data[date]
                if data["empty_day"]:
                    empty_days += 1
                
                # Toplam sorularƒ± hesapla
                for subject_data in data["questions"].values():
                    total_questions += subject_data["correct"] + subject_data["wrong"]
                
                total_pages += data["pages_read"]
                total_notes += data["notes_written"]
                total_study_time += data["study_time"]
            else:
                empty_days += 1
        
        # Rapor penceresi
        report_window = tk.Toplevel(self.root)
        report_window.title("üìÖ Haftalƒ±k Rapor")
        report_window.geometry("400x300")
        
        report_text = tk.Text(report_window, font=('Arial', 11), padx=20, pady=20)
        report_text.pack(fill=tk.BOTH, expand=True)
        
        # Rapor i√ßeriƒüi
        report_content = f"""üìÖ HAFTALƒ∞K RAPOR
{datetime.now().strftime('%d.%m.%Y')} - Son 7 G√ºn

üö´ Bo≈ü Ge√ßen G√ºn: {empty_days} g√ºn
üìù Toplam √á√∂z√ºlen Soru: {total_questions}
üìñ Toplam Okunan Sayfa: {total_pages}
‚úçÔ∏è Toplam Yazƒ±lan Not: {total_notes} sayfa
‚è±Ô∏è Toplam √áalƒ±≈üma S√ºresi: {int(total_study_time//3600)}s {int((total_study_time%3600)//60)}d

üìä G√ºnl√ºk Ortalamalar:
‚Ä¢ Soru: {total_questions/7:.1f}
‚Ä¢ Sayfa: {total_pages/7:.1f}
‚Ä¢ Not: {total_notes/7:.1f}
‚Ä¢ √áalƒ±≈üma: {total_study_time/7/3600:.1f} saat

üí° √ñneriler:
{"‚Ä¢ Harika! B√∂yle devam et! üåü" if empty_days <= 1 else "‚Ä¢ Daha d√ºzenli √ßalƒ±≈ümaya odaklan! üí™"}
{"‚Ä¢ √áok aktif bir haftaydƒ±! üéâ" if total_questions > 50 else "‚Ä¢ Soru √ß√∂zmeyi artƒ±rabilirsin! üìö"}
"""
        
        report_text.insert(tk.END, report_content)
        report_text.config(state=tk.DISABLED)
    
    def reset_today(self):
        """Bug√ºn√º sƒ±fƒ±rla"""
        if messagebox.askyesno("Onay", "Bug√ºnk√º t√ºm verileri silmek istediƒüinizden emin misiniz?"):
            today = self.get_today_key()
            if today in self.data:
                del self.data[today]
                self.save_data()
                self.elapsed_time = 0
                self.stop_timer()
                self.update_display()
                messagebox.showinfo("Ba≈üarƒ±lƒ±", "Bug√ºnk√º veriler silindi!")
    
    def check_day_reset(self):
        """G√ºn deƒüi≈üikliƒüi kontrol√º"""
        # Her dakika kontrol et
        self.root.after(60000, self.check_day_reset)
        
        # Eƒüer gece yarƒ±sƒ± ge√ßtiyse timer'ƒ± sƒ±fƒ±rla
        now = datetime.now()
        if now.hour == 0 and now.minute == 0:
            self.stop_timer()
            self.elapsed_time = 0
            self.update_display()
    
    def __del__(self):
        """Uygulama kapanƒ±rken saat thread'ini durdur"""
        self.clock_running = False

def main():
    root = tk.Tk()
    app = StudyTrackerApp(root)
    
    # Uygulama kapanƒ±rken saat thread'ini durdur
    def on_closing():
        app.clock_running = False
        root.destroy()
    
    root.protocol("WM_DELETE_WINDOW", on_closing)
    root.mainloop()

if __name__ == "__main__":
    main()